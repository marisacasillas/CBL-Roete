# Yi,j,k for the i-th utterance of the j-th child at age k: Y = 1 if utterance is correctly reconstructed,
# Y=0 if not.
subset.suppl.local.data <- subset(suppl.local.data,select=c(1,3,4,5,6,10,11,12))
subset.suppl.local.data$Y <- ifelse(subset.suppl.local.data$reconstructed == "True", 1,0)
subset.suppl.local.data <- subset(subset.suppl.local.data, suppl.local.data$skipped == "False")
# descriptive statistics
means_by_child_recon_perc <- aggregate(subset.suppl.local.data$Y, by = c(list(child = subset.suppl.local.data$child)),FUN = mean)
mean_of_means_by_child_recon_perc <- mean(means_by_child_recon_perc$x)*100
min <- min(means_by_child_recon_perc$x)*100
max <- max(means_by_child_recon_perc$x)*100
means_by_child_recon_score <- aggregate(subset.suppl.local.data$correctedscore, by = c(list(child = subset.suppl.local.data$child)),FUN = mean)
mean_of_means_by_child_recon_score <- mean(means_by_child_recon_score$x)
se_by_child_recon_score <- aggregate(subset.suppl.local.data$correctedscore, by = c(list(child = subset.suppl.local.data$child)),FUN = std.error)
mean_of_se_by_child_recon_score <- mean(se_by_child_recon_score$x)
# model with the binary uncorrected score as dependent variable, age as independent variable (fixed effect), by-child random intercept and random slopes of age.
model_local_uncorrected_suppl <- glmer(Y ~ age + (age|child), family=binomial(link = 'logit'), data = subset.suppl.local.data)
sink("local_uncorrected_suppl.txt")
summary(model_local_uncorrected_suppl)
sink()
summary(model_local_uncorrected_suppl)
ranef(model_local_uncorrected_suppl)
subset.suppl.local.data$recentered_age <- subset.suppl.local.data$age - 2.5
# model with the corrected score as dependent variable, recentered age as independent variable (fixed effect), by-child random intercept and random slopes of age.
model_local_corrected_suppl <- lmer(correctedscore ~ recentered_age + (recentered_age|child), data = subset.suppl.local.data, control=lmerControl(optimizer = "nloptwrap", optCtrl=list(maxfun=1000000)))
sink("local_corrected_suppl.txt")
summary(model_local_corrected_suppl)
sink()
summary(model_local_corrected_suppl)
ranef(model_local_corrected_suppl)
# Select subset of the data, excluding all skipped utterance, and generate binary reconstruction score:
# Yi,j,k for the i-th utterance of the j-th child at age k: Y = 1 if utterance is correctly reconstructed,
# Y=0 if not.
subset.suppl.cumu.data <- subset(suppl.cumu.data,select=c(1,3,4,5,6,10,11,12))
subset.suppl.cumu.data$Y <- ifelse(subset.suppl.cumu.data$reconstructed == "True", 1,0)
subset.suppl.cumu.data <- subset(subset.suppl.cumu.data, suppl.cumu.data$skipped == "False")
# descriptive statistics
means_by_child_recon_perc <- aggregate(subset.suppl.cumu.data$Y, by = c(list(child = subset.suppl.cumu.data$child)),FUN = mean)
mean_of_means_by_child_recon_perc <- mean(means_by_child_recon_perc$x)*100
min <- min(means_by_child_recon_perc$x)*100
max <- max(means_by_child_recon_perc$x)*100
means_by_child_recon_score <- aggregate(subset.suppl.cumu.data$correctedscore, by = c(list(child = subset.suppl.cumu.data$child)),FUN = mean)
mean_of_means_by_child_recon_score <- mean(means_by_child_recon_score$x)
se_by_child_recon_score <- aggregate(subset.suppl.cumu.data$correctedscore, by = c(list(child = subset.suppl.cumu.data$child)),FUN = std.error)
mean_of_se_by_child_recon_score <- mean(se_by_child_recon_score$x)
# model with the binary uncorrected score as dependent variable, age as independent variable (fixed effect), by-child random intercept and random slopes of age.
model_cumu_uncorrected_suppl <- glmer(Y ~ age + (age|child), family=binomial(link = 'logit'), data = subset.suppl.cumu.data)
sink("cumu_uncorrected_suppl.txt")
summary(model_cumu_uncorrected_suppl)
sink()
summary(model_cumu_uncorrected_suppl)
ranef(model_cumu_uncorrected_suppl)
# recenter child age
subset.suppl.cumu.data$recentered_age <- subset.suppl.cumu.data$age - 2.5
# model with the corrected score as dependent variable, recentered age as independent variable (fixed effect), by-child random intercept and random slopes of age.
model_cumu_corrected_suppl <- lmer(correctedscore ~ recentered_age + (recentered_age|child), data = subset.suppl.cumu.data, control=lmerControl(optimizer = "nloptwrap", optCtrl=list(maxfun=1000000)))
sink("cumu_corrected_suppl.txt")
summary(model_cumu_corrected_suppl)
sink()
summary(model_cumu_corrected_suppl)
ranef(model_cumu_corrected_suppl)
# PLOTS
# 1) plot average controlled score over age, per child
## local sample
# collect data for plot
plot1.local.data <- aggregate(subset.suppl.local.data$controlledscore, by = c(list(child = subset.suppl.local.data$child),list(age=subset.suppl.local.data$age)),FUN = sum)
colnames(plot1.local.data)[3] <- "total_score"
plot1.local.data.temp <- aggregate(subset.suppl.local.data$controlledscore, by = c(list(child = subset.suppl.local.data$child),list(age = subset.suppl.local.data$age)), FUN = function(x){NROW(x)})
colnames(plot1.local.data.temp)[3] <- "total_num_utterances"
plot1.data <- merge(plot1.local.data, plot1.local.data.temp, by = c("child","age"))
plot1.data$averagescore <- plot1.local.data$total_score/plot1.local.data$total_num_utterances
# generate plot
plot.local.suppl.recon_score <- ggplot(plot1.local.data,
aes(x=age, y = averagescore, group = child, linetype = child, colour = child)) +
geom_line(size = 1.5) + basic.theme + theme(axis.text.x = element_text(size=22)) +
coord_cartesian(ylim=(c(-0.5,0.5))) +
xlab("\nAge (years)") +
ylab("Average reconstruction \nscore\n") +
ggtitle("Local sampling") +
geom_hline(yintercept=0) +
basic.theme + theme(axis.text.x = element_text(size=22)) +
theme(plot.title = element_text(size=30, face = "bold.italic", hjust = 0.5, margin=margin(b = 30, unit = "pt")))
# save plot
png(paste(plot.path,
"plotsuppllocalrecon_score.png", sep=""),
width=900,height=500,units="px",
bg = "transparent")
plot.local.suppl.recon_score+theme_apa()
dev.off()
plot.local.suppl.recon_score+theme_apa()
library(ggplot2)
library(lme4)
library(grid)
library(gridExtra)
library(stringr)
library(jtools)
library(lattice)
library(plotrix)
#Plot layout settings
basic.theme <- theme(
panel.background = element_rect(
fill = "transparent",colour = NA),
panel.grid.major = element_line(colour = "grey95"),
panel.grid.minor = element_blank(),
plot.background = element_rect(
fill = "transparent",colour = NA),
legend.background = element_rect(
fill="transparent"),
legend.text = element_text(size=24),
legend.title = element_text(size=30),
legend.key.height = unit(2, "lines"),
legend.key = element_rect(colour = NA, fill = NA),
axis.text.x = element_text(size=30, angle=45, hjust=1),
axis.title.x = element_text(size=30),
axis.text.y = element_text(size=28),
axis.title.y = element_text(size=32),
strip.text = element_text(size=30),
panel.spacing = unit(2, "lines"))
# Global variables
rawdata.local.path <- "data/main/local/"
rawdata.cumulative.path <- "data/main/cumulative/"
childuttdata.path <- "data/main/childutt/"
suppl.rawdata.local.path <- "data/suppl/local/"
suppl.rawdata.cumulative.path <- "data/suppl/cumulative/"
plot.path <- "plots/"
print.model.output <- "Y"
# Read in local simulation data
filenames <- list.files(path = rawdata.local.path, pattern="*productiontask-modified.csv")
local.data.list <- lapply(paste0(rawdata.local.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
local.data <- do.call(rbind, local.data.list)
# Prepare data for analyses
local.data$num = 1:nrow(local.data) #overwrite utterance number to avoid double numbers
local.data$age <- gsub("_", ".", local.data$age) #converting age variable to numeric values and months into years
local.data$age <- gsub("6", "5", local.data$age)
local.data$age <- as.numeric(local.data$age)
local.data <- subset(local.data, select = c(2:13))
# Read in cumulative simulation data
filenames <- list.files(path = rawdata.cumulative.path, pattern="*productiontask-modified.csv")
cumu.data.list <- lapply(paste0(rawdata.cumulative.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
cumu.data <- do.call(rbind, cumu.data.list)
# Prepare data for analyses
cumu.data$num = 1:nrow(cumu.data) #overwrite utterance number to avoid double numbers
cumu.data$age <- gsub("_", ".", cumu.data$age) #converting age variable to numeric values and months into years
cumu.data$age <- gsub("6", "5", cumu.data$age)
cumu.data$age <- as.numeric(cumu.data$age)
cumu.data <- subset(cumu.data, select = c(2:13))
# Read in child utterances from input data
filenames <- list.files(path=childuttdata.path, pattern="*.txt")
childutt.data <- NULL
for (file in filenames){
temp.data <- read.delim(paste0(childuttdata.path, file))
colnames(temp.data) <- c("utterance")
temp.data$child <- unlist(strsplit(unlist(strsplit(file, "_age"))[1],"child"))[2]
temp.data$age <- unlist(strsplit(unlist(strsplit(file, "_age"))[2],".txt"))
childutt.data <- rbind(childutt.data,temp.data)
}
# Prepare data for analyses
childutt.data$age <- gsub("_", ".", childutt.data$age) #converting age variable to numeric values and months into years
childutt.data$age <- gsub("6", "5", childutt.data$age)
childutt.data$age <- as.numeric(childutt.data$age)
childutt.data$numwords <- childutt.data$numwords <- str_count(childutt.data$utterance," ")
## Read in local sample data for suppl materials
filenames <- list.files(path = suppl.rawdata.local.path,pattern="*productiontask_keep_all-modified.csv")
suppl.local.data.list <- lapply(paste0(suppl.rawdata.local.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
suppl.local.data <- do.call(rbind, suppl.local.data.list)
# Prepare data for analyses
suppl.local.data$num = 1:nrow(suppl.local.data) # overwrite utterance number to avoid double numbers
suppl.local.data$age <- gsub("_", ".", suppl.local.data$age) #converting age variable to numeric values and months into years
suppl.local.data$age <- gsub("6", "5", suppl.local.data$age)
suppl.local.data$age <- as.numeric(suppl.local.data$age)
suppl.local.data <- subset(suppl.local.data, select = c(2:13))
## Read in cumulative sample data for suppl materials
filenames <- list.files(path = suppl.rawdata.cumulative.path,pattern="*productiontask_keep_all-modified.csv")
suppl.cumu.data.list <- lapply(paste0(suppl.rawdata.cumulative.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
suppl.cumu.data <- do.call(rbind, suppl.cumu.data.list)
# Prepare data for analyses
suppl.cumu.data$num = 1:nrow(suppl.cumu.data) # overwrite utterance number to avoid double numbers
suppl.cumu.data$age <- gsub("_", ".", suppl.cumu.data$age) #converting age variable to numeric values and months into years
suppl.cumu.data$age <- gsub("6", "5", suppl.cumu.data$age)
suppl.cumu.data$age <- as.numeric(suppl.cumu.data$age)
suppl.cumu.data <- subset(suppl.cumu.data, select = c(2:13))
source("1-UncorrectedAccuracy.R")  #TODO: NEEDS FIXING
subset.local.data <- subset(local.data,select=c(1,3,4,5,6,10,11,12))
subset.local.data$Y <- ifelse(subset.local.data$reconstructed == "True", 1,0)
subset.local.data <- subset(subset.local.data, local.data$skipped == "False")
local_means_uncorrected_by_child <- aggregate(subset.local.data$Y, by = c(list(child = subset.local.data$child)),FUN = mean)
local_mean_of_means_uncorrected <- mean(local_means_uncorrected_by_child$x)*100
min <- min(local_means_uncorrected_by_child$x)*100
max <- max(local_means_uncorrected_by_child$x)*100
model_local_uncorrected <- glmer(Y ~ age + (age|child), family=binomial(link = 'logit'), data = subset.local.data)
sink("local_uncorrected_reconstruction.txt")
summary(model_local_uncorrected)
sink()
summary(model_local_uncorrected)
ranef(model_local_uncorrected)
subset.cumu.data <- subset(cumu.data,select=c(1,3,4,5,6,10,11,12))
subset.cumu.data$Y <- ifelse(subset.cumu.data$reconstructed == "True", 1,0)
subset.cumu.data <- subset(subset.cumu.data, cumu.data$skipped == "False")
# Descriptive statistics
cumu_means_uncorrected_by_child <- aggregate(subset.cumu.data$Y, by = c(list(child = subset.cumu.data$child)),FUN = mean)
cumu_mean_of_means_uncorrected <- mean(cumu_means_uncorrected_by_child$x)*100
min <- min(cumu_means_uncorrected_by_child$x)*100
max <- max(cumu_means_uncorrected_by_child$x)*100
model_cumu_uncorrected <- glmer(Y ~ age + (age|child), family=binomial(link = 'logit'), data = subset.cumu.data)
sink("cumu_uncorrected_reconstruction.txt")
summary(model_cumu_uncorrected)
sink()
summary(model_cumu_uncorrected)
ranef(model_cumu_uncorrected)
# Check for severeness for non-convergence; not severe.
relgrad <- with(model_cumu_uncorrected@optinfo$derivs,solve(Hessian,gradient))
max(abs(relgrad))
plot1.local.data <- aggregate(subset.local.data$repetition, by = c(list(age=subset.local.data$age)),FUN = sum)
subset.local.data$age
########## Corrected accuracy for the local and cumulative samples ##########
# MAIN TEXT ANALYSES
## local sample
# Select subset of the data, excluding all skipped utterance, and generate binary reconstruction score:
# Yi,j,k for the i-th utterance of the j-th child at age k: Y = 1 if utterance is correctly reconstructed,
# Y=0 if not.
subset.local.data <- subset(local.data,select=c(1,3,4,5,6,10,11,12))
subset.local.data$Y <- ifelse(subset.local.data$reconstructed == "True", 1,0)
subset.local.data <- subset(subset.local.data, local.data$skipped == "False")
# Descriptive statistics
local_means_corrected_by_child <- aggregate(subset.local.data$correctedscore, by = c(list(child = subset.local.data$child)),FUN = mean)
local_mean_of_means_corrected_by_child <- mean(local_means_corrected_by_child$x)
local_se_corrected_by_child <- aggregate(subset.local.data$correctedscore, by = c(list(child = subset.local.data$child)),FUN = std.error)
local_mean_of_se_corrected_by_child <- mean(local_se_corrected_by_child$x)
# Recenter child age
subset.local.data$recentered_age <- subset.local.data$age - 2.5
# Model with the corrected score as dependent variable, recentered age as independent variable (fixed effect), by-child random intercept and random slopes of age.
model_local_corrected <- lmer(correctedscore ~ recentered_age + (recentered_age|child), data = subset.local.data, control=lmerControl(optimizer = "nloptwrap", optCtrl=list(maxfun=1000000)))
sink("local_corrected_reconstruction.txt")
summary(model_local_corrected)
sink()
summary(model_local_corrected)
ranef(model_local_corrected )
## cumulative sample
# Select subset of the data, excluding all skipped utterance, and generate binary reconstruction score:
# Yi,j,k for the i-th utterance of the j-th child at age k: Y = 1 if utterance is correctly reconstructed,
# Y=0 if not.
subset.cumu.data <- subset(cumu.data,select=c(1,3,4,5,6,10,11,12))
subset.cumu.data$Y <- ifelse(subset.cumu.data$reconstructed == "True", 1,0)
subset.cumu.data <- subset(subset.cumu.data, cumu.data$skipped == "False")
# Descriptive statistics
cumu_means_corrected_by_child <- aggregate(subset.cumu.data$correctedscore, by = c(list(child = subset.cumu.data$child)),FUN = mean)
cumu_mean_of_means_corrected_by_child <- mean(cumu_means_corrected_by_child$x)
cumu_se_corrected_by_child <- aggregate(subset.cumu.data$correctedscore, by = c(list(child = subset.cumu.data$child)),FUN = std.error)
cumu_mean_of_se_corrected_by_child <- mean(cumu_se_corrected_by_child$x)
# Recenter child age
subset.cumu.data$recentered_age <- subset.cumu.data$age - 2.5
# Model with the corrected score as dependent variable, recentered age as independent variable (fixed effect), by-child random intercept and random slopes of age.
model_cumu_corrected <- lmer(correctedscore ~ recentered_age + (recentered_age|child), data = subset.cumu.data, control=lmerControl(optimizer = "nloptwrap", optCtrl=list(maxfun=1000000)))
sink("cumu_corrected_reconstruction.txt")
summary(model_cumu_corrected)
sink()
summary(model_cumu_corrected)
ranef(model_cumu_corrected )
# MAIN TEXT PLOTS
# 1) Plot with x-axis: age, y-axis: average length-and-repetition controlled reconstruction score
## Local sample
# Collect data
plot1.local.data <- aggregate(subset.local.data$correctedscore, by = c(list(child = subset.local.data$child),list(age=subset.local.data$age)),FUN = sum)
library(ggplot2)
library(lme4)
library(grid)
library(gridExtra)
library(stringr)
library(jtools)
library(lattice)
library(plotrix)
#Plot layout settings
basic.theme <- theme(
panel.background = element_rect(
fill = "transparent",colour = NA),
panel.grid.major = element_line(colour = "grey95"),
panel.grid.minor = element_blank(),
plot.background = element_rect(
fill = "transparent",colour = NA),
legend.background = element_rect(
fill="transparent"),
legend.text = element_text(size=24),
legend.title = element_text(size=30),
legend.key.height = unit(2, "lines"),
legend.key = element_rect(colour = NA, fill = NA),
axis.text.x = element_text(size=30, angle=45, hjust=1),
axis.title.x = element_text(size=30),
axis.text.y = element_text(size=28),
axis.title.y = element_text(size=32),
strip.text = element_text(size=30),
panel.spacing = unit(2, "lines"))
# Set this source file's directory as the working directory
# NOTE: If you want the following command to work, use Source in Rstudio rather than Run
here <- dirname(parent.frame(2)$ofile)
setwd(here)
# Global variables
rawdata.local.path <- "data/main/local/"
rawdata.cumulative.path <- "data/main/cumulative/"
childuttdata.path <- "data/main/childutt/"
suppl.rawdata.local.path <- "data/suppl/local/"
suppl.rawdata.cumulative.path <- "data/suppl/cumulative/"
plot.path <- "plots/"
print.model.output <- "Y"
# Read in local simulation data
filenames <- list.files(path = rawdata.local.path, pattern="*productiontask-modified.csv")
local.data.list <- lapply(paste0(rawdata.local.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
local.data <- do.call(rbind, local.data.list)
# Prepare data for analyses
local.data$num = 1:nrow(local.data) #overwrite utterance number to avoid double numbers
local.data$age <- gsub("_", ".", local.data$age) #converting age variable to numeric values and months into years
local.data$age <- gsub("6", "5", local.data$age)
local.data$age <- as.numeric(local.data$age)
local.data <- subset(local.data, select = c(2:13))
# Read in cumulative simulation data
filenames <- list.files(path = rawdata.cumulative.path, pattern="*productiontask-modified.csv")
cumu.data.list <- lapply(paste0(rawdata.cumulative.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
cumu.data <- do.call(rbind, cumu.data.list)
# Prepare data for analyses
cumu.data$num = 1:nrow(cumu.data) #overwrite utterance number to avoid double numbers
cumu.data$age <- gsub("_", ".", cumu.data$age) #converting age variable to numeric values and months into years
cumu.data$age <- gsub("6", "5", cumu.data$age)
cumu.data$age <- as.numeric(cumu.data$age)
cumu.data <- subset(cumu.data, select = c(2:13))
# Read in child utterances from input data
filenames <- list.files(path=childuttdata.path, pattern="*.txt")
childutt.data <- NULL
for (file in filenames){
temp.data <- read.delim(paste0(childuttdata.path, file))
colnames(temp.data) <- c("utterance")
temp.data$child <- unlist(strsplit(unlist(strsplit(file, "_age"))[1],"child"))[2]
temp.data$age <- unlist(strsplit(unlist(strsplit(file, "_age"))[2],".txt"))
childutt.data <- rbind(childutt.data,temp.data)
}
# Prepare data for analyses
childutt.data$age <- gsub("_", ".", childutt.data$age) #converting age variable to numeric values and months into years
childutt.data$age <- gsub("6", "5", childutt.data$age)
childutt.data$age <- as.numeric(childutt.data$age)
childutt.data$numwords <- childutt.data$numwords <- str_count(childutt.data$utterance," ")
## Read in local sample data for suppl materials
filenames <- list.files(path = suppl.rawdata.local.path,pattern="*productiontask_keep_all-modified.csv")
suppl.local.data.list <- lapply(paste0(suppl.rawdata.local.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
suppl.local.data <- do.call(rbind, suppl.local.data.list)
# Prepare data for analyses
suppl.local.data$num = 1:nrow(suppl.local.data) # overwrite utterance number to avoid double numbers
suppl.local.data$age <- gsub("_", ".", suppl.local.data$age) #converting age variable to numeric values and months into years
suppl.local.data$age <- gsub("6", "5", suppl.local.data$age)
suppl.local.data$age <- as.numeric(suppl.local.data$age)
suppl.local.data <- subset(suppl.local.data, select = c(2:13))
## Read in cumulative sample data for suppl materials
filenames <- list.files(path = suppl.rawdata.cumulative.path,pattern="*productiontask_keep_all-modified.csv")
suppl.cumu.data.list <- lapply(paste0(suppl.rawdata.cumulative.path,filenames),na.strings=c("NaN","Nan"), stringsAsFactors = FALSE,read.csv)
suppl.cumu.data <- do.call(rbind, suppl.cumu.data.list)
# Prepare data for analyses
suppl.cumu.data$num = 1:nrow(suppl.cumu.data) # overwrite utterance number to avoid double numbers
suppl.cumu.data$age <- gsub("_", ".", suppl.cumu.data$age) #converting age variable to numeric values and months into years
suppl.cumu.data$age <- gsub("6", "5", suppl.cumu.data$age)
suppl.cumu.data$age <- as.numeric(suppl.cumu.data$age)
suppl.cumu.data <- subset(suppl.cumu.data, select = c(2:13))
# Run models and generate plots
#source("1-UncorrectedAccuracy.R")  #TODO: NEEDS FIXING
source("2-CorrectedAccuracy.R") #TODO: NEEDS FIXING
# Generate plot
plot.local.reconstruction <- ggplot(plot1.local.data,
aes(x=age, y = averagescore, group = child, linetype = child, colour = child)) +
geom_line(size = 1.5) + basic.theme + theme(axis.text.x = element_text(size=22)) +
coord_cartesian(ylim=(c(-0.5,0.5))) +
xlab("\nAge (years)") +
ylab("Average reconstruction \nscore\n") +
ggtitle("Local sampling") +
geom_hline(yintercept=0) +
basic.theme + theme(axis.text.x = element_text(size=22)) +
theme(plot.title = element_text(size=30, face = "bold.italic", hjust = 0.5, margin=margin(b = 30, unit = "pt")))
plot.path
plot.local.reconstruction <- ggplot(plot1.local.data,
aes(x=age, y = averagescore, group = child, linetype = child, colour = child)) +
geom_line(size = 1.5) + basic.theme + theme(axis.text.x = element_text(size=22)) +
coord_cartesian(ylim=(c(-0.5,0.5))) +
xlab("\nAge (years)") +
ylab("Average reconstruction \nscore\n") +
ggtitle("Local sampling") +
geom_hline(yintercept=0) +
basic.theme + theme(axis.text.x = element_text(size=22)) +
theme(plot.title = element_text(size=30, face = "bold.italic", hjust = 0.5, margin=margin(b = 30, unit = "pt")))
ggsave(paste0(plot.path, "plot.local.reconstruction"), plot = plotboth_reconstructionscore)
ggsave(paste0(plot.path, "plotlocalrecon.png"), plot = plot.local.reconstruction)
setwd("~/Documents/GitHub_projects/CBL-Roete/analysis")
ggsave(paste0(plot.path, "plotlocalrecon.png"), plot = plot.local.reconstruction)
ggsave(paste0(plot.path, "plotlocalrecon.png"), plot = plot.local.reconstruction)
ggsave(paste0(plot.path, "plotlocalrecon.png"), plot = plot.local.reconstruction+theme_apa())
plot.cumu.reconstruction <- ggplot(plot1.cumu.data,
aes(x=age, y = averagescore, group = child, linetype = child, colour = child)) +
geom_line(size = 1.5) + basic.theme + theme(axis.text.x = element_text(size=22)) +
#scale_colour_manual(name = "Child:", values = groupcolours) +
coord_cartesian(ylim=(c(-0.5,0.5))) +
xlab("\nAge (years)") +
ylab("Average reconstruction \nscore\n") +
ggtitle("Cumulative sampling") +
geom_hline(yintercept=0) +
basic.theme + theme(axis.text.x = element_text(size=22)) +
theme(plot.title = element_text(size=30, face = "bold.italic", hjust = 0.5, margin=margin(b = 30, unit = "pt")))
ggsave(paste0(plot.path, "plotcumurecon.pngg"), plot = plot.cumu.reconstruction + theme_apa())
# Generate plot
plot.cumu.reconstruction <- ggplot(plot1.cumu.data,
aes(x=age, y = averagescore, group = child, linetype = child, colour = child)) +
geom_line(size = 1.5) + basic.theme + theme(axis.text.x = element_text(size=22)) +
#scale_colour_manual(name = "Child:", values = groupcolours) +
coord_cartesian(ylim=(c(-0.5,0.5))) +
xlab("\nAge (years)") +
ylab("Average reconstruction \nscore\n") +
ggtitle("Cumulative sampling") +
geom_hline(yintercept=0) +
basic.theme + theme(axis.text.x = element_text(size=22)) +
theme(plot.title = element_text(size=30, face = "bold.italic", hjust = 0.5, margin=margin(b = 30, unit = "pt")))
ggsave(paste0(plot.path, "plotcumurecon.png"), plot = plot.cumu.reconstruction + theme_apa())
## Combine local and cumulative sample
# Function to combine two plot that share a legend
grid_arrange_shared_legend <- function(..., ncol = length(list(...)), nrow = 1, position = c("bottom", "right")) {
plots <- list(...)
position <- match.arg(position)
g <- ggplotGrob(plots[[1]] +
theme(legend.position = position))$grobs
legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
lheight <- sum(legend$height)
lwidth <- sum(legend$width)
gl <- lapply(plots, function(x) x +
theme(legend.position = "none"))
gl <- c(gl, ncol = ncol, nrow = nrow)
combined <- switch(position,
"bottom" = arrangeGrob(do.call(arrangeGrob, gl),
legend,ncol = 1,
heights = unit.c(unit(1, "npc") - lheight, lheight)),
"right" = arrangeGrob(do.call(arrangeGrob, gl),
legend, ncol = 2,
widths = unit.c(unit(1, "npc") - lwidth, lwidth)))
grid.newpage()
grid.draw(combined)
# return gtable invisibly
invisible(combined)
}
# Function to remove the x-axis of the right-hand side graph without distorted graph sizes,
# the x-axis is the same as the x-axis of the left-hand side graph
arrange_related_x_axes <- function(..., nrow=NULL, ncol=NULL, as.table=FALSE,
main=NULL, sub=NULL, plot=TRUE) {
dots <- list(...)
n <- length(dots)
if(is.null(nrow) & is.null(ncol)) { nrow = floor(n/2) ; ncol = ceiling(n/nrow)}
if(is.null(nrow)) { nrow = ceiling(n/ncol)}
if(is.null(ncol)) { ncol = ceiling(n/nrow)}
fg <- frameGrob(layout=grid.layout(nrow,ncol))
ii.p <- 1
for(ii.row in seq(1, nrow)){
ii.table.row <- ii.row
if(as.table) {ii.table.row <- nrow - ii.table.row + 1}
for(ii.col in seq(1, ncol)){
ii.table <- ii.p
if(ii.p > n) break
fg <- placeGrob(fg, ggplotGrob(dots[[ii.table]]),
row=ii.table.row, col=ii.col)
ii.p <- ii.p + 1
}
}
if(!is.null(main) | !is.null(sub)){
g <- frameGrob() # large frame to place title(s) and content
g <- packGrob(g, fg)
if (!is.null(main))
g <- packGrob(g, textGrob(main), side="top")
if (!is.null(sub))
g <- packGrob(g, textGrob(sub, gp=gpar(fontsize=30), vjust=-1, hjust=0), side="bottom")
} else {
g <- fg
}
if(plot) grid.draw(g)
invisible(g)
}
# Generate combined plot
plot.local.reconstruction.noxtitle <- plot.local.reconstruction +
xlab("\n") +
ylab("Average reconstruction score\n") +
theme(axis.text.x = element_text(size=18),
axis.text.y = element_text(size=18),
legend.position="none")
plot.acc.reconstruction.noxtitle <- plot.acc.reconstruction +
xlab("\n") +
ylab("\n") +
theme(legend.key.width = unit(2, "cm"),
axis.text.x = element_text(size=18),
axis.text.y = element_text(size=18),
legend.position=c(0.75,0.25))
arrange_related_x_axes(plot.local.reconstruction.noxtitle,
plot.acc.reconstruction.noxtitle,
nrow=1, ncol = 2, as.table=TRUE,
sub="Age (years)")
arrange_related_x_axes(plot.local.reconstruction.noxtitle,
plot.acc.reconstruction.noxtitle,
nrow=1, ncol = 2, as.table=TRUE,
sub="Age (years)")
grid.newpage()
rrange_related_x_axes(plot.local.reconstruction.noxtitle,
plot.acc.reconstruction.noxtitle,
nrow=1, ncol = 2, as.table=TRUE,
sub="Age (years)")
arrange_related_x_axes(plot.local.reconstruction.noxtitle,
plot.acc.reconstruction.noxtitle,
nrow=1, ncol = 2, as.table=TRUE,
sub="Age (years)")
plotboth_reconstructionscore <- arrange_related_x_axes(plot.local.reconstruction.noxtitle,
plot.acc.reconstruction.noxtitle,
nrow=1, ncol = 2, as.table=TRUE,
sub="Age (years)")
ggsave(paste0(plot.path, "plotbothreconstruction.png"), plot = plotboth_reconstructionscore)
source("2-CorrectedAccuracy.R") #TODO: NEEDS FIXING
source("3-UnseenWords.R") #TODO: NEEDS FIXING
source("4-ChilduttAnalysis.R") #TODO: NEEDS FIXING
